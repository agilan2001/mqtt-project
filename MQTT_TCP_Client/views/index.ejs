<!DOCTYPE html>
<html>

<head>
  <title>
    <%= title %>
  </title>
  <link rel='stylesheet' href='/stylesheets/style.css' />
</head>

<body>
  <h1>
    <%= title %>
  </h1>

  Publish<br>
  Message : <input type='text' id="publish_mes" />
  Topic : <input type='text' id="publish_topic" />
  QOS : <input type='text' id="publish_qos" />
  Retain : <input type='checkbox' id="publish_retain" />
  <button onclick="publish_click()">PUBLISH</button><br>
  <br><br>
  <p id="rec_mes"></p>

  Subscribe<br>
  Topic : <input type='text' id="subscribe_topic" />
  QOS : <input type='text' id="subscribe_qos" />
  <button onclick="subscribe_click()">SUBSCRIBE</button>

</body>
<script>
  fetch("http://localhost:3000/client/connect", {
    method: 'post',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ clientId: "client30" })
  }).then(res => res.text()).then(text => {
    console.log(text)
    ws = new WebSocket("ws://localhost:5000/client_ws");
    ws.addEventListener('open', function (event) {
      ws.send('client30');
    });
    ws.addEventListener('message',function(event){
      rec_mes.innerHTML = event.data
    })
  })


  function subscribe_click() {
    fetch("http://localhost:3000/client/subscribe", {
      method: 'post',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        clientId: "client30",
        topic: subscribe_topic.value,
        qos: parseInt(subscribe_qos.value)
      })
    }).then(res => res.text()).then(console.log)

  }
  function publish_click() {
    fetch("http://localhost:3000/client/publish", {
      method: 'post',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        clientId: "client30",
        message: publish_mes.value,
        topic: publish_topic.value,
        qos: parseInt(publish_qos.value)
      })
    }).then(res => res.text()).then(console.log)
  }
</script>

</html>